[TOC]

#正则表达式
***

##RegExp
正则表达式, Regular Expression, RegExp
规定字符串中出现**规则的表达式**

查找、验证、替换、切割

***

##规则
###关键词的原文
最简单的正则，必须和原文完全匹配

>买表  买了表  买个表  买了个表  **

###备选字符集
+ 规定某**一位**字符的备选字符集列表
+ 必须且只能多选1
>买表  买了表  买个表  买了个表 --> 买[了个]表

+ 如果备选字符集中unicode号是连续的，可以使用 - 连接开头字符和结尾字符  

>1位数字：[0123456789] --> [0-9]
1位小写字母     -->       [a-z]
1位字母         -->      [a-zA-Z]
1为英文字符或数字   -->   [0-9a-zA-Z]

###预定义字符集
针对常用的备选字符集提供了简化的符号

>一位数字          -->   \d    [0-9]
一位数字字母下划线 -->   \w    [0-9a-zA-Z_]
一位空字符        -->   \s    换行（回车）、制表符（TAB）、空格
一位除了换行外，其余的所有字符  -->   .

###量词
+ 规定了字符集出现的次数
+ 默认一个量词，仅修饰左侧紧邻的字符集
1. 确定数量  
        {m,n} - 出现至少m个，最多n个
        {m,}  - 出现m个以上
        {m}   - 必须m个 

>[0-9]{4}  -->  4位数字

2. 不确定数量
        *   -->  可有可无，多了不限
        +   -->  1个以上
        ?   -->  可有可无，最多1个  

3. 选择和分组
选择： | --> 或
分组： ()
希望用多个字符集被同一个两次修饰时使用

>手机号： +86或0086  18838299097
手机号的正则表达式 ： (\ +86|0086)?\s*1[3-9]\d{9}

4. 指定匹配位置

开头和结尾
^  -->  开头的xxx     
$  -->  结尾xxx

仅匹配开头的规则和结尾的规则时使用
固定搭配：
>^正则表达式$

表示从头到尾完整匹配

**只要是验证，必须前加^ 后加$**

其余的验证匹配不要都加！
>匹配字符串中的开头的空字符 ^\s+
匹配字符串中的结尾的空字符  \s+$

注意：
- 如果^出现在了[]中括号中修饰了字符集，表示 非（否定的意思）

>[^'"]  -->  除了 '"以外的其他字符都匹配

- ^ 不能跟其他的符号连用

***

##支持RegExp的String API

###search
查找，仅判断有没有

``` javascript
var i=str.search(reg)  
```

返回第一个匹配正则的下标
如果没有找到，返回 -1
仅查找有没有，无法继续查找之后的所有关键词

``` javascript
    var reply=prompt("请输入回复信息");
    //    买表  买了表  买个表  买了个表
    var reg=/买[了个]{0,2}表/;
    if(reply.search(reg)!=-1){
        alert("发现敏感词，请重新发言");
        console.log(reply.search(reg));
    }else{
        alert("您是一个好人");
    }
```

***

###match
匹配，获取所有关键词的内容和个数
``` javascript
var kwords=str.match(reg)  
```

match() 方法返回的kwords 是一个数组对象！

reg - 正则表达式结尾 +g
- 如果reg结尾+g,表示查找全部匹配的关键词（全局查找）-返回索引数组
- 否则，默认仅查找第一个匹配的关键词  - 返回哈希数组
- 如果没有找到，返回null
- 如果忽略大小写， reg结尾+i
比如：
匹配的正则表达式既要全局查找，又要忽略大小写

>reg=/正则表达式/ig


注意：如果一个结果有可能是null的时候，使用的时候，都要先判断，再使用

``` javascript
    var str="No zuo no die,No can no bi bi";
    var reg=/no/gi;
    var kwords=str.match(reg);
    if(kwords){
        console.log(kwords);
    }else{
        alert("您查找的关键词不存在");
    }
```

``` javascript
(4) ["No", "no", "No", "no"]
```

***

###replace
替换，一般替换操作都是全局替换，那么reg +g 表示全局替换

>str=str.replace(reg（旧值）, "替换的新值");


``` javascript
    var str="\t hello world \t"; // \t - 转义字符 表示一个制表符  TAB
    console.log(str);
    function trim(){ // 删除开头和结尾的空白符
        return str.replace(/^\s+|\s+$/g, "");
    }
    console.log(trim());
```

``` javascript
    /*  练习：替换所有敏感词
    *   纪检  纪委  纪检监察 为 **或****
    * */
    var str="纪委负责全国纪检干部的纪检监察工作";
    var kwords=null;
    
    var reg=/纪[检委]/;  //1个条件，返回的Hash数组length=1
    kwords=str.match(reg);
    console.log(kwords);
    
    var reg=/纪[检委](监察)?/;  //2个条件，返回的Hash数组length=2
    //    正则表达式不加g，使用while循环来推动整个的查找过程，找一个改一个
    // 只要找到敏感词，就把敏感替换成 **或****
    while((kwords=str.match(reg))!=null){
        console.log(kwords);
    //    每循环一次，就找到了一个敏感词，那么就根据情况来替换值
    //        如果关键词是2个字符，就替换成 **
    //                           否则，   ****
        str=str.replace(reg, kwords[0].length==2?"**":"****");
    }
    console.log(str);
```

``` javascript
["纪委", index: 0, input: "纪委负责全国纪检干部的纪检监察工作", groups: undefined]
(2) ["纪委", undefined, index: 0, input: "纪委负责全国纪检干部的纪检监察工作", groups: undefined]
(2) ["纪检", undefined, index: 6, input: "**负责全国纪检干部的纪检监察工作", groups: undefined]
(2) ["纪检监察", "监察", index: 11, input: "**负责全国**干部的纪检监察工作", groups: undefined]
**负责全国**干部的****工作
```

***

##RegEXp对象

封装了一条正则表达式，提供了使用正则表达式验证和查找的方法

***

###如何创建正则对象？
>1. var reg=/正则表达式/ig; 使用固定的正则表达式
>2. var reg=new RegExp("正则表达式","ig");

+ 如果正则表达式是由变量拼接而成，或者在运行的时候动态改变，优先使用第二种
+ 正则表达式的 \ 都要写成 \\

***

###exec
查找，几乎都要加g

>var arr=reg.exec(str)  同时获得关键词的内容和位置

+ 每次只能找下一个匹配的关键词
+ arr[0],保存了本次查找的关键词内容，如果找不到，就返回null
+ arr.index属性中，保存了本次找到的关键词的首字母位置下标
+ reg.lastIndex属性， 用于规定下次匹配的起始位置

``` javascript
    var reg=/no/ig;
    var str="No zuo no die,No can no bi bi";
    //       01234567890123456789012345678
    var arr=null;
    while((arr=reg.exec(str))!=null){
        console.log("在位置"+arr.index+"找到了敏感词"+arr[0]);
        console.log("下次从"+reg.lastIndex+"位置开始查找");
    }
```

>在位置0找到了敏感词No
下次从2位置开始查找
在位置7找到了敏感词no
下次从9位置开始查找
在位置14找到了敏感词No
下次从16位置开始查找
在位置21找到了敏感词no
下次从23位置开始查找

+ **贪婪模式**：默认情况下，正则表达式都会匹配尽量长的字符串
+ **懒惰模式**：只匹配最短的符合条件的字符串

因为.* 引起了贪婪模式，所以，我们可以通过：.* --> (.*?)  方式把贪婪模式改为懒惰模式！

####如何获得本次查找的结果中的部分内容？ 
两步
1. 在正则表达式中使用(), 包裹住需要获得的部分
2. 在本次查找的同时，使用**RegExp.$n**, 获得第n个()中匹配的子内容

``` javascript
    /*获取html中所有a元素中href属性中的url*/
    var html=
        "<link rel='stylesheet' href='http://index.css'/>"+
        "<a name='Top'></a>"+
        "<a class='navi' href='http://IOTEK.cn'></a>"+
        "<h1 class='title1'></h1>"+
        "<a href='http://zhizuobiao.com' target='_blank'></a>"+
        "<div></div>";

    // var reg=/<a\s+.*href=['"][^'"]*['"]/ig;      //贪婪模式
    var reg=/<a\s+(.*?)href=['"]([^'"]*)['"]/ig;    //懒惰模式
            //       $1             $2

    var arr=[];     // 临时保存每次exec查询的符合正则表达式的a元素结果
    var urls=[];    // 保存所有找到的url - a元素href属性值
    while((arr=reg.exec(html))!=null){
        console.log(arr);
        // 将本次查找的结果中的第2个圆括号里的子内容压入到 urls
        urls.push(RegExp.$2);
    }   // 退出循环  表示  再也找不到了
    console.log(urls.join("\n"));
```

```javascript
Array(3)
0: "<a name='Top'></a><a class='navi' href='http://IOTEK.cn'"   //本次查找的符合正则表达式的内容
1: "name='Top'></a><a class='navi' "                            //符合第一个圆括号里正则表达式的内容
2: "http://IOTEK.cn"                                            //符合第二个圆括号里正则表达式的内容
groups: undefined
index: 48                                                       //第一次找到符合正则内容的字符串的下标位置
input: "<link rel='stylesheet' href='http://index.css'/><a name='Top'></a><a class='navi' href='http://IOTEK.cn'></a><h1 class='title1'></h1><a href='http://zhizuobiao.com' target='_blank'></a><div></div>"
length: 3
__proto__: Array(0)

Array(3)
0: "<a href='http://zhizuobiao.com'"
1: ""
2: "http://zhizuobiao.com"
groups: undefined
index: 133
input: "<link rel='stylesheet' href='http://index.css'/><a name='Top'></a><a class='navi' href='http://IOTEK.cn'></a><h1 class='title1'></h1><a href='http://zhizuobiao.com' target='_blank'></a><div></div>"
length: 3
__proto__: Array(0)

http://IOTEK.cn
http://zhizuobiao.com
```

***

